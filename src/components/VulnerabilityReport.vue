<template>
  <div class="report" id="vulnerability-report">
    <h2>Vulnerable Libraries and Frameworks</h2>
    <div class="report-container" v-if="showReport">
      <table>
        <thead>
          <tr>
            <th
              v-for="(heading, index) in vulnerabilityReport.headings"
              :key="index"
            >
              {{ heading.text }}
            </th>
          </tr>
        </thead>
        <tbody>
          <template
            v-for="(vulnerability,
            index) in vulnerabilityReport.vulnerabilities"
          >
            <tr :key="index">
              <td>{{ vulnerability.name }}</td>
              <td>{{ vulnerability.vulnCount }}</td>
              <td>{{ vulnerability.severity }}</td>
            </tr>
            <tr :key="vulnerability.url">
              <td colspan="2">
                <a
                  :href="vulnerability.url"
                  target="_blank"
                  rel="noopener noreferrer"
                  >Read the security advisory</a
                >
              </td>
            </tr>
          </template>
        </tbody>
      </table>
      <dl>
        <dt>* Vulnerability count</dt>
        <dd>
          The total number of known vulnerabilities for framework or library
        </dd>
        <dt>** Highest Severity</dt>
        <dd>The highest known individual vulnerability</dd>
      </dl>
    </div>
    <p v-else>
      No vulnerabilities found! Someone is going to sleep well tonight 😁
    </p>
  </div>
</template>

<script>
export default {
  name: "VulnerabilityReport",
  props: {
    report: Object,
    showReport: Boolean,
  },
  computed: {
    vulnerabilityReport: function () {
      let vulnerabilities = [];
      this.report.items.forEach((item) => {
        vulnerabilities.push({
          name: item.detectedLib.text,
          vulnCount: item.vulnCount,
          severity: item.highestSeverity,
          url: item.detectedLib.url,
        });
      });

      return {
        headings: this.report.headings,
        vulnerabilities,
      };
    },
  },
};
</script>

<style></style>
